steps:
  # Build static website
  - name: node:18.13
    entrypoint: npm
    args: ["install"]
  - name: node:18.13
    entrypoint: npm
    args: ["run", "build"]

  # Set environment variables
  - name: "gcr.io/cloud-builders/gcloud"
    args: ["secrets", "versions", "access", "latest", "--secret", "backend-address"]
    env:
      - 'REACT_APP_BACKEND_ENDPOINT=$_BACKEND_ADDRESS'

  - name: "gcr.io/google.com/cloudsdktool/cloud-sdk"
    args: ["gcloud", "storage", "rm", "-r", "gs://${_FRONTEND_BUCKET_NAME}/**"]
  - name: "gcr.io/google.com/cloudsdktool/cloud-sdk"
    args:
      [
        "gcloud",
        "storage",
        "cp",
        "-r",
        "/workspace/build/*",
        "gs://${_FRONTEND_BUCKET_NAME}",
        
      ]
  - name: "gcr.io/cloud-builders/gcloud"
      args:
        - "app"
        - "deploy"
      env:
        - "_BACKEND_ADDRESS=${_BACKEND_ADDRESS}"